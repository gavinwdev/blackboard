!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("axios")):"function"==typeof define&&define.amd?define(["axios"],e):"object"==typeof exports?exports.blackboard=e(require("axios")):t.blackboard=e(t.axios)}(window,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(e,n){e.exports=t},function(t,e,n){"use strict";n.r(e);var i=!0,o=Object.prototype.toString,r=Object.getPrototypeOf;function s(t,e,n){if(x(t)){for(var i=0;i<t.length;i++)if(e(i,t[i]))return}else if($(t)){for(var o in t)if((n||t.hasOwnProperty(o))&&e(o,t[o]))return}else e(t,t)}function h(t,e){if(x(t)){for(var n=0;n<t.length;n++)if(e(n,t[n]))return!0}else{if(!$(t))return e(t,t);for(var i in t)if(t.hasOwnProperty(i)&&e(i,t[i]))return!0}}function c(){var t=!1,e=0,n=arguments[e];if(S(n)&&(t=n,n=arguments[++e]),x(n))return n.map(function(e){return t?c(e):e});if($(n)){var i=d(n);return s(n,function(e,n){i[e]=t?c(n):n}),i}return n}function u(){var t=!1,e=0,n=arguments[e];S(n)&&(t=n,n=arguments[++e]),t?Array.prototype.slice.call(arguments,e+1).forEach(function(t){l(n,t)}):Array.prototype.slice.call(arguments,e+1).forEach(function(t){a(n,t)})}function p(){var t=!1,e=0,n={};return S(arguments[e])&&(t=arguments[e],e++),t?Array.prototype.slice.call(arguments,e).forEach(function(t){l(n,t)}):Array.prototype.slice.call(arguments,e).forEach(function(t){a(n,t)}),n}function a(t,e){s(e,function(e,n){t[e]=n})}function l(t,e){s(e,function(e,n){null==t[e]?t[e]=n:$(t[e])&&$(n)?l(t[e],n):t[e]=n})}function d(t){function e(){}return e.prototype=t,new e}function f(t,e){!function(t,e){var n=d(e.prototype);n.constructor=t,t.prototype=n}(t,e),t.super=function(){e.apply(this,arguments)}}function m(t){return w(t)?t.toLowerCase():t}function y(t){return w(t)?t.toUpperCase():t}function g(t){return void 0===t}function v(t){return void 0!==t}function x(t){return t instanceof Array}function $(t){return null!==t&&"object"==typeof t}function b(t){return null!==t&&"object"==typeof t&&!r(t)}function w(t){return"string"==typeof t}function E(t){return"number"==typeof t}function C(t){return"[object Date]"===o.call(t)}function N(t){return"function"==typeof t}function k(t){return"[object RegExp]"===o.call(t)}function S(t){return"boolean"==typeof t}function I(t,e){var n=t===e;return n||(x(t)&&x(e)?t.length===e.length&&(n=!h(t,function(t,n){return!I(n,e[t])})):$(t)&&$(e)&&r(t)===r(e)&&(n=!h(t,function(t,n){return!I(n,e[t])}))),n}function T(t){i&&console.log(t)}function V(t,e){return t.some(function(t){return t===e})}function D(t,e,n){return t.some(function(t){return t===e||n&&m(t)===m(e)})}function A(t,e,n){if(!t)return!1;for(var i,o=!0,r=e.split("."),h=t;o&&r.length>0;)i=r.shift(),o=!1,s(h,function(t,e){return(o=t===i||n&&m(t)===m(i))&&(h=e),o},!0);return o}function O(t,e,n){if(!t)return null;for(var i,o=!0,r=e.split("."),h=t;o&&r.length>0;)i=r.shift(),o=!1,s(h,function(t,e){return(o=t===i||n&&m(t)===m(i))&&(h=e),o},!0);return o?h:null}function j(t,e,n,i){if(t){for(var o,r=!0,h=e.split("."),c=t;r&&h.length>0;)o=h.shift(),0===h.length?c[o]=n:(r=!1,s(c,function(t,e){return(r=t===o||i&&m(t)===m(o))&&(c=e),r},!0));if(!r)throw new Error(e+": Can not set property of undefined")}}function P(){return Array.prototype.concat.apply([],arguments)}function M(){this.handlers=[]}function U(){this.messengers={}}function B(t){return Array.prototype.slice.call(t.childNodes,0)}function L(t){B(t).forEach(function(e){t.removeChild(e)})}function q(t,e){var n=t.parentNode;null!=n&&(n.insertBefore(e,t),n.removeChild(t))}function F(t){var e=t.parentNode;null!=e&&e.removeChild(t)}function W(t,e){var n=t.parentNode;B(n).forEach(function(i){i.previousSibling===t&&i!==e&&n.removeChild(i),i.nextSibling===e&&i!==t&&n.removeChild(i)})}function _(t,e){var n=t.parentNode;n.lastChild===t?n.appendChild(e):n.insertBefore(e,t.nextSibling)}function K(t){return t instanceof M}M.prototype.on=function(t){this.handlers.push(t)},M.prototype.off=function(t){for(var e=0;e<this.handlers.length;e++)this.handlers[e]===t&&this.handlers.splice(e,1)},M.prototype.fire=function(t,e){var n;e=e||this;for(var i=0;i<this.handlers.length;i++)N(this.handlers[i])&&(n=this.handlers[i].call(e,t));return n},U.prototype.getMessenger=function(t){return this.messengers[t]||(this.messengers[t]=new M),this.messengers[t]},U.prototype.on=function(t,e){this.getMessenger(t).on(e)},U.prototype.off=function(t,e){this.getMessenger(t).off(e)},U.prototype.fire=function(t,e,n){return this.getMessenger(t).fire(e,n)};var R={filter:"filter",service:"service",component:"component",directive:"directive"},Y=new H;function H(){this.container={},this.waitingToExtends={},this.insContainer={}}function z(t){this.plainMap=new Map,this.regexMap=new Map,this.parentSubject=t}function Z(t,e,n){this.selfKey="__self__",this.onchange=t,this.parentKey=e,this.deepProxy=n}function G(t,e,n){this.props=t,this.parentKey=e,this.deepProxy=n}H.prototype.getMapping=function(t){return this.container[t]||(this.container[t]={}),this.container[t]},H.prototype.getInstances=function(t){return this.insContainer[t]||(this.insContainer[t]=[]),this.insContainer[t]},H.prototype.register=function(t,e,n){if(-1!==e.indexOf("."))throw new Error('Illegal character "."');var i=this.getMapping(t);if(null==i[e])i[e]=[];else{var o=i[e].filter(function(t){return t.prototype.$$def.namespace===n.prototype.$$def.namespace});if(o.length>0)throw new Error(e+" is exist under namespace "+o[0].prototype.$$def.namespace)}i[e].push(n)},H.prototype.registerComponent=function(t,e){this.register(R.component,t,e)},H.prototype.registerDirective=function(t,e){this.register(R.directive,t,e)},H.prototype.contains=function(t,e,n){var i,o=this.getMapping(t),r=e.split("."),s="";return r.length>1&&(e=r.pop(),s=r.join(".")),null!=(i=n?O(o,e,!0):o[e])&&!(s&&i.length>0&&0===(i=i.filter(function(t){var e=t.prototype.$$def;return e.namespace&&m(e.namespace)===m(s)})).length)},H.prototype.containsComponent=function(t){return this.contains(R.component,t,!0)},H.prototype.containsDirective=function(t){return this.contains(R.directive,t,!0)},H.prototype.get=function(t,e,n){var i,o=this.getMapping(t),r=e.split("."),s="";if(r.length>1&&(e=r.pop(),s=r.join(".")),null==(i=n?O(o,e,!0):o[e]))throw new Error(t+" "+e+" is not defined");if(s&&i.length>0&&0===(i=i.filter(function(t){var e=t.prototype.$$def;return e.namespace&&m(e.namespace)===m(s)})).length)throw new Error(e+" is not exist under namespace "+s);if(i.length>1){var h=i.map(function(t){return t.prototype.$$def.namespace});throw new Error("namespace "+h.join("|")+" all have "+e)}return i[0]},H.prototype.getComponent=function(t){return this.get(R.component,t)},H.prototype.getDirective=function(t){return this.get(R.directive,t)},H.prototype.getFilter=function(t){return this.get(R.filter,t)},H.prototype.getService=function(t){return this.get(R.service,t)},H.prototype.create=function(t,e){var n,i=this.get(t,e);switch(t){case t.component:n=this.createComponent(i);break;case t.directive:n=this.createDirective(i);break;case t.filter:n=this.createFilter(i);break;case t.service:n=this.createService(i);break;default:n=new i}return n},H.prototype.createComponent=function(t){w(t)&&(t=this.getComponent(t));var e=new t;return e.$onInit(),e},H.prototype.createDirective=function(t){w(t)&&(t=this.getDirective(t));var e=new t;return e.$onInit(),e},H.prototype.createFilter=function(t){w(t)&&(t=this.getFilter(t));var e=new t;return e.$onInit(),e},H.prototype.createService=function(t){var e,n=this.getInstances(R.service);if(w(t)&&(t=this.getService(t)),!t.prototype.$$def.nonShared){var i=n.filter(function(e){return e instanceof t});i.length&&(e=i[0])}return e||((e=new t).$onInit(),n.push(e)),e},H.prototype.service=function(t){return this.createService(t)},H.prototype.getWaitingToExtends=function(t){return this.waitingToExtends[t]||(this.waitingToExtends[t]=[]),this.waitingToExtends[t]},H.prototype.setWaitingToExtends=function(t,e){this.waitingToExtends[t]=e},H.prototype.buildConstructor=function(t,e,n){var i,o=this,r=o.getWaitingToExtends(n.contractType);if(i=N(n.getConstructor)?n.getConstructor():function t(){var e=this;N(t.super)&&t.super.call(this),$(this.$$def.props)&&u(!0,this,c(!0,this.$$def.props)),x(this.$$def.events)&&this.$$def.events.forEach(function(t){e[t]=new M})},N(n.superClass)&&f(i,n.superClass),$(e.superInstance)&&e.superInstance instanceof n.superClass&&(i.prototype=d(e.superInstance)),i.prototype.$$key=t,w(e.extends))if(Y.contains(n.contractType,e.extends)){var s=Y.get(n.contractType,e.extends),h=a(e,s);l(t,h,i)}else r.push({superName:e.extends,callback:function(n){var o=a(e,n);l(t,o,i)}});else l(t,e,i);function a(t,e){if(e.prototype.$$def&&e.prototype.$$def.protected)throw new Error(n.contractType+": "+t.extends+" is protected, it is not allowed to extend!");return p(!0,c(!0,e.prototype.$$def),t)}function l(t,e,i){i.prototype.$$def=e,$(e.methods)&&u(i.prototype,e.methods),e.local||Y.register(n.contractType,t,i);var s=[];r.forEach(function(e){e.superName===t?e.callback.call(null,i):s.push(e)}),o.setWaitingToExtends(n.contractType,s)}return i},H.prototype.injectServices=function(t){var e=this;$(t.$$def.inject)&&s(t.$$def.inject,function(n,i){t[n]=e.createService(i)})},z.prototype.on=function(t,e,n){var i=k(t)?this.regexMap:this.plainMap;i.has(t)||i.set(t,[]),n&&(e.beforeChanged=n.beforeChanged),i.get(t).push(e)},z.prototype.off=function(t,e){var n=k(t)?this.regexMap:this.plainMap;if(n.has(t)){var i=n.get(t),o=i.indexOf(e);-1!==o&&i.splice(o,1)}},z.prototype.fireChanged=function(t,e){var n=this;this.plainMap.has(t)&&this.plainMap.get(t).forEach(function(i){i.beforeChanged||i.call(n,t,e)}),this.regexMap.forEach(function(i,o){o.test(t)&&i.forEach(function(i){i.beforeChanged||i.call(n,t,e)})}),null!=this.parentSubject&&this.parentSubject.fireChanged(t,e)},z.prototype.fireChanging=function(t,e){var n=this;this.plainMap.has(t)&&this.plainMap.get(t).forEach(function(i){i.beforeChanged&&i.call(n,t,e)}),this.regexMap.forEach(function(i,o){o.test(t)&&i.forEach(function(i){i.beforeChanged&&i.call(n,t,e)})}),null!=this.parentSubject&&this.parentSubject.fireChanging(t,e)},z.prototype.destroy=function(){this.plainMap.clear(),this.regexMap.clear(),this.parentSubject=null},Z.prototype.get=function(t,e){if(this.selfKey===e)return t;var n=t[e];return this.deepProxy&&$(n)&&(n=new Proxy(n,new Z(this.onchange,this.parentKey+e+".",this.deepProxy))),n},Z.prototype.set=function(t,e,n){if(this.deepProxy&&$(n)){var i=n[this.selfKey];null!=i&&(n=i)}var o=t[e];if(o!==n||x(t)&&"length"===e){var r={isValid:!0,oldValue:o,newValue:n};this.onchange.fireChanging(this.parentKey+e,r),r.isValid&&(t[e]=n,this.onchange.fireChanged(this.parentKey+e,{oldValue:o,newValue:n}))}return!0},G.prototype.get=function(t,e){var n=t[e],i=this.parentKey+e;return this.deepProxy&&$(n)&&(n=new Proxy(n,new G(this.props,i+".",this.deepProxy))),-1===this.props.indexOf(i)&&this.props.push(i),n};var J={},Q={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'};function X(t){this.options=t}"+ - * / % === !== == != < > <= >= && || ! = |".split(" ").forEach(function(t){J[t]=!0}),X.prototype.lex=function(t){for(this.text=t,this.index=0,this.tokens=[];this.index<this.text.length;){var e=this.text.charAt(this.index);if('"'===e||"'"===e)this.readString(e);else if(this.isNumber(e)||"."===e&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(e,"(){}[].,;:?"))this.tokens.push({index:this.index,text:e}),this.index++;else if(this.isWhitespace(e))this.index++;else{var n=e+this.peek(),i=n+this.peek(2),o=J[e],r=J[n],s=J[i];if(o||r||s){var h=s?i:r?n:e;this.tokens.push({index:this.index,text:h,operator:!0}),this.index+=h.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},X.prototype.is=function(t,e){return-1!==e.indexOf(t)},X.prototype.peek=function(t){var e=t||1;return this.index+e<this.text.length&&this.text.charAt(this.index+e)},X.prototype.isNumber=function(t){return"0"<=t&&t<="9"&&"string"==typeof t},X.prototype.isWhitespace=function(t){return" "===t||"\r"===t||"\t"===t||"\n"===t||"\v"===t||" "===t},X.prototype.isIdentifierStart=function(t){return this.options.isIdentifierStart?this.options.isIdentifierStart(t,this.codePointAt(t)):this.isValidIdentifierStart(t)},X.prototype.isValidIdentifierStart=function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"||"_"===t||"$"===t},X.prototype.isIdentifierContinue=function(t){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(t,this.codePointAt(t)):this.isValidIdentifierContinue(t)},X.prototype.isValidIdentifierContinue=function(t,e){return this.isValidIdentifierStart(t,e)||this.isNumber(t)},X.prototype.codePointAt=function(t){return 1===t.length?t.charCodeAt(0):(t.charCodeAt(0)<<10)+t.charCodeAt(1)-56613888},X.prototype.peekMultichar=function(){var t=this.text.charAt(this.index),e=this.peek();if(!e)return t;var n=t.charCodeAt(0),i=e.charCodeAt(0);return n>=55296&&n<=56319&&i>=56320&&i<=57343?t+e:t},X.prototype.isExpOperator=function(t){return"-"===t||"+"===t||this.isNumber(t)},X.prototype.throwError=function(t,e,n){n=n||this.index;var i=v(e)?"s "+e+"-"+this.index+" ["+this.text.substring(e,n)+"]":" "+n;throw new Error("Lexer Error: "+t+" at column"+i+" in expression ["+this.text+"].")},X.prototype.readNumber=function(){for(var t="",e=this.index;this.index<this.text.length;){var n=m(this.text.charAt(this.index));if("."===n||this.isNumber(n))t+=n;else{var i=this.peek();if("e"===n&&this.isExpOperator(i))t+=n;else if(this.isExpOperator(n)&&i&&this.isNumber(i)&&"e"===t.charAt(t.length-1))t+=n;else{if(!this.isExpOperator(n)||i&&this.isNumber(i)||"e"!==t.charAt(t.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:e,text:t,constant:!0,value:Number(t)})},X.prototype.readIdent=function(){var t=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var e=this.peekMultichar();if(!this.isIdentifierContinue(e))break;this.index+=e.length}this.tokens.push({index:t,text:this.text.slice(t,this.index),identifier:!0})},X.prototype.readString=function(t){var e=this.index;this.index++;for(var n="",i=t,o=!1;this.index<this.text.length;){var r=this.text.charAt(this.index);if(i+=r,o){if("u"===r){var s=this.text.substring(this.index+1,this.index+5);s.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+s+"]"),this.index+=4,n+=String.fromCharCode(parseInt(s,16))}else{n+=Q[r]||r}o=!1}else if("\\"===r)o=!0;else{if(r===t)return this.index++,void this.tokens.push({index:e,text:i,constant:!0,value:n});n+=r}this.index++}this.throwError("Unterminated quote",e)};var tt={};function et(t){this.type=t,this.childNodes=[]}function nt(){nt.super.call(this,tt.Program)}function it(){it.super.call(this,tt.ExpressionStatement)}function ot(t,e,n){ot.super.call(this,tt.AssignmentExpression),this.left=t,this.right=e,this.operator=n}function rt(t,e,n){rt.super.call(this,tt.ConditionalExpression),this.test=t,this.alternate=e,this.consequent=n}function st(t,e,n){st.super.call(this,tt.LogicalExpression),this.operator=t,this.left=e,this.right=n}function ht(t,e,n){ht.super.call(this,tt.BinaryExpression),this.operator=t,this.left=e,this.right=n}function ct(t,e){ct.super.call(this,tt.UnaryExpression),this.prefix=!0,this.operator=t,this.arg=e}function ut(t){ut.super.call(this,tt.Literal),this.value=t}function pt(t,e){pt.super.call(this,tt.CallExpression),this.callee=t,this.args=e,this.filter=!1}function at(t,e,n){at.super.call(this,tt.MemberExpression),this.object=t,this.property=e,this.computed=n}function lt(t){lt.super.call(this,tt.Identifier),this.name=t}function dt(){dt.super.call(this,tt.ArrayExpression)}function ft(){ft.super.call(this,tt.Property),this.kind="init",this.key=null,this.value=null,this.computed=!1}function mt(t){mt.super.call(this,tt.ObjectExpression),this.properties=t}function yt(t,e){this.lexer=t,this.options=e}function gt(t){gt.super.call(this,t)}tt.Program="Program",tt.ExpressionStatement="ExpressionStatement",tt.AssignmentExpression="AssignmentExpression",tt.ConditionalExpression="ConditionalExpression",tt.LogicalExpression="LogicalExpression",tt.BinaryExpression="BinaryExpression",tt.UnaryExpression="UnaryExpression",tt.CallExpression="CallExpression",tt.MemberExpression="MemberExpression",tt.Identifier="Identifier",tt.Literal="Literal",tt.ArrayExpression="ArrayExpression",tt.Property="Property",tt.ObjectExpression="ObjectExpression",et.prototype.appendChild=function(t){this.childNodes.push(t)},et.prototype.compile=function(t,e,n){return this.childNodes.map(function(i){return i.compile(t,e||{},n)})},f(nt,et),nt.prototype.compile=function(t,e){return this.childNodes[0].compile(t,e||{})},f(it,et),it.prototype.compile=function(t,e,n){return this.childNodes[0].compile(t,e||{},n)},f(ot,et),ot.prototype.compile=function(t,e){var n=this.left.compile(t,e,{assignmentLeft:!0}),i=this.right.compile(t,e);n.obj[n.prop]=i},f(rt,et),rt.prototype.compile=function(t,e){return this.test.compile(t)?this.alternate.compile(t,e):this.consequent.compile(t,e)},f(st,et),st.prototype.compile=function(t,e){var n,i=this.left.compile(t,e),o=this.right.compile(t,e);switch(this.operator){case"&&":case"||":n=i&&o}return n},f(ht,et),ht.prototype.compile=function(t,e){var n,i=this.left.compile(t,e),o=this.right.compile(t,e);switch(this.operator){case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"<":n=i<o;break;case">":n=i>o;break;case"<=":n=i<=o;break;case">=":n=i>=o;break;case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o}return n},f(ct,et),ct.prototype.compile=function(t,e){var n,i=this.arg.compile(t,e);switch(this.operator){case"+":n=i;break;case"-":n=-i;break;case"!":n=!i}return n},f(ut,et),ut.prototype.compile=function(){return this.value},f(pt,et),pt.prototype.compile=function(t,e){var n=this.callee.compile(t,e,{callee:!0}),i=this.args.map(function(n){return n.compile(t,e)});if(this.filter){var o=e.createFilter(n.prop);if(Ht(o))return o.$execute.apply(o,i);throw new Error('Filter "'+n.prop+'" is not defined')}var r=n.obj[n.prop];if(N(r))return r.apply(n.obj,i);throw new Error(n.prop+" is not a function")},f(at,et),at.prototype.compile=function(t,e,n){var i=this.object.compile(t,e,n);return x(i)?i[this.property.compile(i,e,n)]:this.property.compile(i,e,n)},f(lt,et),lt.prototype.compile=function(t,e,n){if(n){if(n.assignmentLeft||n.callee)return{obj:t,prop:this.name};if(n.propertyKey)return this.name}var i=t[this.name];return null==i&&e.locals&&(i=e.locals[this.name]),i},f(dt,et),f(ft,et),ft.prototype.compile=function(t,e){return{key:this.key.compile(t,e,{propertyKey:!0}),value:this.value.compile(t,e)}},f(mt,et),mt.prototype.compile=function(t,e){var n={};return this.properties.forEach(function(i){var o=i.compile(t,e);n[o.key]=o.value}),n},yt.prototype.throwError=function(t,e){throw new Error("Syntax Error: Token '"+e.text+"'"+t+" at column "+(e.index+1)+" of the expression ["+this.text+"] starting at ["+this.text.substring(e.index)+"].")},yt.prototype.parse=function(t){this.text=t,this.tokens=this.lexer.lex(t);var e=this.program();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),e},yt.prototype.program=function(){for(var t=new nt;;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&t.appendChild(this.expressionStatement()),!this.expect(";"))return t},yt.prototype.expressionStatement=function(){var t=new it;return t.appendChild(this.filterChain()),t},yt.prototype.filterChain=function(){for(var t=this.expression();this.expect("|");)t=this.filter(t);return t},yt.prototype.expression=function(){return this.assignment()},yt.prototype.assignment=function(){var t,e=this.ternary();if(this.expect("=")){if((t=e).type!==tt.Identifier&&t.type!==tt.MemberExpression)throw new Error("Trying to assign a value to a non l-value");e=new ot(e,this.assignment(),"=")}return e},yt.prototype.ternary=function(){var t,e=this.logicalOR();return this.expect("?")&&(t=this.expression(),this.consume(":"))?new rt(e,t,this.expression()):e},yt.prototype.logicalOR=function(){for(var t=this.logicalAND();this.expect("||");)t=new st("||",t,this.logicalAND());return t},yt.prototype.logicalAND=function(){for(var t=this.equality();this.expect("&&");)t=new st("&&",t,this.equality());return t},yt.prototype.equality=function(){for(var t,e=this.relational();t=this.expect("==","!=","===","!==");)e=new ht(t.text,e,this.relational());return e},yt.prototype.relational=function(){for(var t,e=this.additive();t=this.expect("<",">","<=",">=");)e=new ht(t.text,e,this.additive());return e},yt.prototype.additive=function(){for(var t,e=this.multiplicative();t=this.expect("+","-");)e=new ht(t.text,e,this.multiplicative());return e},yt.prototype.multiplicative=function(){for(var t,e=this.unary();t=this.expect("*","/","%");)e=new ht(t.text,e,this.unary());return e},yt.prototype.unary=function(){var t;return(t=this.expect("+","-","!"))?new ct(t.text,this.unary()):this.primary()},yt.prototype.primary=function(){var t,e;for(this.expect("(")?(t=this.filterChain(),this.consume(")")):this.expect("[")?t=this.arrayDeclaration():this.expect("{")?t=this.object():this.options.literals.hasOwnProperty(this.peek().text)?t=new ut(this.options.literals[this.consume().text]):this.peek().identifier?t=this.identifier():this.peek().constant?t=this.constant():this.throwError("not a primary expression",this.peek());e=this.expect("(","[",".");)"("===e.text?(t=new pt(t,this.parseArguments()),this.consume(")")):"["===e.text?(t=new at(t,this.expression(),!0),this.consume("]")):"."===e.text?t=new at(t,this.identifier(),!1):this.throwError("IMPOSSIBLE");return t},yt.prototype.filter=function(t){for(var e=[t],n=[this.identifier()];this.expect(".");)n.push(this.identifier());var i=new pt(new lt(n.map(function(t){return t.name}).join(".")),e);for(i.filter=!0;this.expect(":");)e.push(this.expression());return i},yt.prototype.parseArguments=function(){var t=[];if(")"!==this.peekToken().text)do{t.push(this.filterChain())}while(this.expect(","));return t},yt.prototype.identifier=function(){var t=this.consume();return t.identifier||this.throwError("is not a valid identifier",t),new lt(t.text)},yt.prototype.constant=function(){return new ut(this.consume().value)},yt.prototype.arrayDeclaration=function(){var t=new dt;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;t.appendChild(this.expression())}while(this.expect(","));return this.consume("]"),t},yt.prototype.object=function(){var t,e=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;t=new ft,this.peek().constant?(t.key=this.constant(),t.computed=!1,this.consume(":"),t.value=this.expression()):this.peek().identifier?(t.key=this.identifier(),t.computed=!1,this.peek(":")?(this.consume(":"),t.value=this.expression()):t.value=t.key):this.peek("[")?(this.consume("["),t.key=this.expression(),this.consume("]"),t.computed=!0,this.consume(":"),t.value=this.expression()):this.throwError("invalid key",this.peek()),e.push(t)}while(this.expect(","));return this.consume("}"),new mt(e)},yt.prototype.consume=function(t){if(0===this.tokens.length)throw new Error("Unexpected end of expression: "+this.text);var e=this.expect(t);return e||this.throwError("is unexpected, expecting ["+t+"]",this.peek()),e},yt.prototype.peekToken=function(){if(0===this.tokens.length)throw new Error("Unexpected end of expression: "+this.text);return this.tokens[0]},yt.prototype.peek=function(t,e,n,i){return this.peekAhead(0,t,e,n,i)},yt.prototype.peekAhead=function(t,e,n,i,o){if(this.tokens.length>t){var r=this.tokens[t],s=r.text;if(s===e||s===n||s===i||s===o||!e&&!n&&!i&&!o)return r}return!1},yt.prototype.expect=function(t,e,n,i){var o=this.peek(t,e,n,i);return!!o&&(this.tokens.shift(),o)},f(gt,X),gt.prototype.isValidIdentifierStart=function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"||"_"===t||"$"===t||"@"===t||":"===t||"*"===t},gt.prototype.isValidIdentifierContinue=function(t,e){return this.isValidIdentifierStart(t,e)||this.isNumber(t)||"-"===t||"."===t},gt.prototype.expectString=function(t){var e=t.length;return this.index+e<=this.text.length&&t===this.text.substr(this.index,e)},gt.prototype.readComment=function(t,e){var n=this.index;this.index+=t.length;for(var i="",o=t;this.index<this.text.length;){var r=this.text.charAt(this.index);if(o+=r,this.expectString(e))return o+=e,this.index+=e.length,void this.tokens.push({index:n,text:o,comment:!0,value:i});i+=r,this.index++}this.throwError("Unterminated comment",n)},gt.prototype.readText=function(){for(var t=this.index,e="";this.index<this.text.length;){var n=this.text.charAt(this.index),i=this.peek();if("<"===n&&this.isIdentifierStart(i)||"/"===i||this.expectString("\x3c!--"))break;e+=n,this.index++}this.tokens.push({index:t,text:e,textTag:!0})},gt.prototype.readTag=function(t,e,n,i){for(this.tokens.push({index:this.index,text:t,tag:!0,closing:n,begin:!0,doctype:i}),this.index+=t.length,this.readIdent();this.index<this.text.length;){var o=this.text.charAt(this.index);if(!n){var r=o+this.peek();if(r==="/"+e){this.tokens.push({index:this.index,text:r,tag:!0,closing:!0,end:!0}),this.index+=r.length;break}}if(o===e){this.tokens.push({index:this.index,text:e,tag:!0,closing:!!i||n,end:!0}),this.index+=e.length;break}this.isIdentifierStart(this.peekMultichar())?this.readIdent():'"'===o||"'"===o?this.readString(o):this.isWhitespace(o)?this.index++:"="===o?(this.tokens.push({index:this.index,text:"=",equal:!0}),this.index++):this.throwError("Unexpected next character ",this.index,this.index+1)}},gt.prototype.lex=function(t){this.text=t,this.index=0,this.tokens=[];for(var e=!!this.options.allowDocType;this.index<this.text.length;){var n=this.text.charAt(this.index),i=this.peek(),o=this.peek(2);this.expectString("\x3c!--")?this.readComment("\x3c!--","--\x3e"):"<"===n&&this.isIdentifierStart(i)?this.readTag("<",">",!1):this.expectString("</")&&this.isIdentifierStart(o)?this.readTag("</",">",!0):this.expectString("<!DOCTYPE")?e?this.readTag("<!",">",!0,!0):this.throwError("DOCTYPE is not allowed",this.index,this.index+1):this.readText()}return this.tokens};var vt="load unload change submit reset select blur focus abort keydown keypress keyup click dblclick mousedown mousemove mouseout mouseover mouseup".split(" "),xt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entity:6,processingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12,custom:101};function $t(t,e,n){this.nodeType=t,this.nodeName=e,this.nodeValue=n,this.childNodes=[],this.parentNode=null,this.previousSibling=null,this.nextSibling=null,this.firstChild=null,this.lastChild=null,this.ownerVDocument=null,this.scope=null}function bt(t,e){bt.super.call(this,xt.custom,t),this.linker=e}function wt(t){wt.super.call(this,xt.element,t),this.attributes=[],this.element=null,this.component=null,this.selfClosed=!1,this.compileOptions=null,this.isComponent=!1}function Et(t,e){Et.super.call(this,xt.attribute,t,e),this.quote='"',this.orgNodeName=t,this.isEvent=!1,this.isBinding=!1,this.isDomEvent=!1,this.isDirective=!1,this.directive=null,this.ownerVElement=null,this.ownerElement=null,this.ownerComponent=null,this.compileOptions=null,this.binding=new Tt}function Ct(){Ct.super.call(this,xt.text,"#text"),this.binding=new Tt,this.element=null}function Nt(){Nt.super.call(this,xt.comment,"#comment")}function kt(){kt.super.call(this,xt.documentType)}function St(){St.super.call(this,xt.documentFragment,"#document-fragment")}function It(t){this.text=t,this.value=null,this.oldValue=null}function Tt(){this.scope=null,this.text="",this.isExp=!1,this.segments=[],this.rightStr="",this.output=!1,this.value=null,this.change=new M}function Vt(t,e){Vt.super.call(this,t,e)}$t.prototype.$pushChild=function(t){t.parentNode=this,this.childNodes.push(t)},$t.prototype.$buildSibling=function(){if(0!==this.childNodes.length){var t=this;1===this.childNodes.length?(this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[0]):(this.firstChild=this.childNodes[0],this.lastChild=this.childNodes[this.childNodes.length-1],this.childNodes.forEach(function(e,n){0!==n?n!==t.childNodes.length-1?(e.previousSibling=t.childNodes[n-1],e.nextSibling=t.childNodes[n+1]):e.previousSibling=t.childNodes[n-1]:e.nextSibling=t.childNodes[n+1]})),this.childNodes.forEach(function(t){t.$buildSibling()})}},$t.prototype.$clearParentAndSibling=function(){this.parentNode=null,this.previousSibling=null,this.nextSibling=null},$t.prototype.$remove=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},$t.prototype.$destroy=function(){this.$remove(),this.$clearParentAndSibling(),this.childNodes.length=0,this.firstChild=null,this.lastChild=null,this.ownerVDocument=null,this.scope=null},$t.prototype.createElement=function(t){return new wt(t)},$t.prototype.createAttr=function(t){return new Et(t)},$t.prototype.createCustom=function(t,e){return new bt(t,e)},$t.prototype.hasChildNodes=function(){return 0!==this.childNodes.length},$t.prototype.clearChildNodes=function(){this.childNodes.forEach(function(t){t.destroy()}),this.childNodes.length=0},$t.prototype.appendChild=function(t){return null!=t.parentNode&&t.parentNode.removeChild(t),t.parentNode=this,0===this.childNodes.length?this.firstChild=t:(this.lastChild.nextSibling=t,t.previousSibling=this.lastChild),t.compile(this.compileOptions),this.lastChild=t,this.childNodes.push(t),t},$t.prototype.insertBefore=function(t,e){null!=e.parentNode&&e.parentNode.removeChild(e);var n=this.childNodes.indexOf(t);if(-1===n)throw new Error("Ref node is not a child of specified node");return e.parentNode=this,null!=t.previousSibling&&(e.previousSibling=t.previousSibling,t.previousSibling.nextSibling=e),e.nextSibling=t,t.previousSibling=e,0===n&&(this.firstChild=e),e.compile(this.compileOptions),this.childNodes.splice(n,0,e),e},$t.prototype.insertAfter=function(t,e){return null==t.nextSibling?this.appendChild(e):this.insertBefore(t.nextSibling,e)},$t.prototype.removeChild=function(t){var e=this.childNodes.indexOf(t);if(-1===e)throw new Error("Remove node is not a child of specified node");return null!=t.previousSibling&&(t.previousSibling.nextSibling=t.nextSibling),null!=t.nextSibling&&(t.nextSibling.previousSibling=t.previousSibling),0===e&&(this.firstChild=t.nextSibling),e===this.childNodes.length-1&&(this.lastChild=t.previousSibling),t.$clearParentAndSibling(),this.childNodes.splice(e,1),t},$t.prototype.replaceChild=function(t,e){null!=e.parentNode&&e.parentNode.removeChild(e);var n=this.childNodes.indexOf(t);if(-1===n)throw new Error("Ref node is not a child of specified node");return e.parentNode=this,e.previousSibling=t.previousSibling,e.nextSibling=t.nextSibling,this.firstChild===t&&(this.firstChild=e),this.lastChild===t&&(this.lastChild=e),t.$clearParentAndSibling(),e.compile(this.compileOptions),this.childNodes.splice(n,1,e),e},$t.prototype.cloneNode=function(){throw new Error("not implemented")},$t.prototype.compile=function(t){this.childNodes.forEach(function(e){e.compile(t)})},$t.prototype.directives=function(){var t=[];return this.childNodes.map(function(t){return t.directives()}).forEach(function(e){t=t.concat(e)}),t},$t.prototype.getDirective=function(){return[]},$t.prototype.link=function(t){return this.scope=t,this.childNodes.map(function(e){e.link(t)})},$t.prototype.afterLink=function(){this.childNodes.forEach(function(t){t.afterLink()})},$t.prototype.detect=function(){this.hasChange()&&this.update()},$t.prototype.hasChange=function(){return!1},$t.prototype.update=function(){},$t.prototype.destroy=function(){this.childNodes.map(function(t){t.destroy()}),this.$destroy()},f(bt,$t),bt.prototype.link=function(t){return this.scope=t,this.linker.call(this,t)},bt.prototype.afterLink=function(){if(N(this.onInsert))return this.onInsert.call(this)},bt.prototype.detect=function(){if(N(this.onDetect))return this.onDetect.call(this)},bt.prototype.hasChange=function(){if(N(this.onHasChange))return this.onHasChange.call(this)},bt.prototype.update=function(){if(N(this.onUpdate))return this.onUpdate.call(this)},bt.prototype.destroy=function(){if(N(this.onDestroy))return this.onDestroy.call(this);this.$destroy()},f(function(){bt.super.call(this,xt.document)},$t),f(wt,$t),wt.prototype.$pushAttribute=function(t){t.ownerVElement=this,this.attributes.push(t)},wt.prototype.hasAttributes=function(){return 0!==this.attributes.length},wt.prototype.setAttribute=function(t,e){var n,i=this.attributes.filter(function(e){return e.belongTo(t)});return i.length>0?(n=i[0]).setValue(e):((n=new Et(t,e)).ownerVElement=this,n.compile(this.compileOptions)),this.attributes.push(attr),n},wt.prototype.removeAttribute=function(t){var e=[],n=this;if(t instanceof Et){var i=this.attributes.indexOf(t);-1!==i&&(e=n.attributes.splice(i,1))}else this.attributes.filter(function(e){return e.belongTo(t)}).forEach(function(t){var i=n.attributes.indexOf(t);t.destroy(),e=n.attributes.splice(i,1)});return e.length>0?e[0]:null},wt.prototype.appendAttribute=function(t){if(null!=t.ownerVElement)throw new Error("Current attribute is not new!");return t.ownerVElement=this,t.compile(this.compileOptions),this.attributes.push(t),t},wt.prototype.getOuterTpl=function(){var t="",e="";this.attributes.forEach(function(e){t+=" ",t+=e.getOuterTpl()}),this.childNodes.forEach(function(t){e+=t.getOuterTpl()});var n="<"+this.nodeName+t+">"+e;return this.selfClosed||(n+="</"+this.nodeName+">"),n},wt.prototype.getInnerTpl=function(){var t="";return this.childNodes.forEach(function(e){t+=e.getOuterTpl()}),t},wt.prototype.setOuterTpl=function(t){var e=this;Ot(t).forEach(function(t){t.parentNode=null,e.parentNode.insertBefore(e,t)}),e.parentNode.removeChild(e)},wt.prototype.setInnerTpl=function(t){var e=this;this.clearChildNodes(),Ot(t).forEach(function(t){t.parentNode=null,e.appendChild(t)})},wt.prototype.getDirective=function(t){var e=[];return this.attributes.map(function(t){return t.directives()}).forEach(function(t){e=e.concat(t)}),e.filter(function(e){return e.$$key===t})},wt.prototype.compile=function(t){this.compileOptions=t,this.attributes.forEach(function(e){e.compile(t)}),this.isComponent=t.containsComponent(this.nodeName),this.isComponent||this.childNodes.forEach(function(e){e.compile(t)})},wt.prototype.directives=function(){var t=[];return this.attributes.map(function(t){return t.directives()}).forEach(function(e){t=t.concat(e)}),null==this.component&&this.childNodes.map(function(t){return t.directives()}).forEach(function(e){t=t.concat(e)}),t},wt.prototype.link=function(t){var e=this;return e.scope=t,e.element=document.createElement(e.nodeName),this.isComponent&&(this.component=this.compileOptions.createComponent(this.nodeName),this.component.$bindVNode(this)),null==e.component?(this.attributes.forEach(function(n){n.link(t,e.element)}),e.childNodes.forEach(function(n){e.element.appendChild(n.link(t))})):(t.$$childComponents.push(e.component),e.component.$$parentComponent=t,e.attributes.forEach(function(n){n.link(t,e.element,e.component)}),e.component.$mount(e.element)),e.element},wt.prototype.afterLink=function(){this.attributes.forEach(function(t){t.afterLink()}),null==this.component&&this.childNodes.forEach(function(t){t.afterLink()})},wt.prototype.detect=function(){this.attributes.forEach(function(t){t.detect()}),null==this.component&&this.childNodes.forEach(function(t){t.detect()})},wt.prototype.dispose=function(t){null==this.component?this.childNodes.forEach(function(t){t.destroy()}):t&&(this.component=null),this.attributes.forEach(function(t){t.destroy()}),this.attributes.length=0,this.removeDomElement(),this.compileOptions=null,this.$destroy()},wt.prototype.destroy=function(){null!=this.component&&(this.component.$dispose(!0),this.component=null),this.dispose()},wt.prototype.getDomElement=function(){return this.element},wt.prototype.removeDomElement=function(){null!=this.element&&F(this.element)},f(Et,$t),Et.prototype.belongTo=function(t){return this.orgNodeName===t},Et.prototype.setValue=function(t){this.nodeValue=t,this.compile(this.options)},Et.prototype.compile=function(t){if(this.compileOptions=t,this.isEvent=this.nodeName.startsWith("@"),this.isBinding=this.nodeName.startsWith(":"),this.isDirective=this.nodeName.startsWith("*"),(this.isEvent||this.isBinding||this.isDirective)&&(this.nodeName=this.nodeName.substr(1)),this.isDomEvent=V(vt,this.nodeName),this.binding.setOutput(this.isEvent),this.binding.bind(this.nodeValue,this.isEvent||this.isBinding||this.isDirective),this.isDirective){if(!t.containsDirective(this.nodeName))throw new Error("directive "+this.nodeName+" is not defined");this.directive=t.createDirective(this.nodeName),this.directive.$bindVNode(this),this.binding.setOutput(this.directive.output)}},Et.prototype.link=function(t,e,n){var i=this;this.scope=t,this.ownerElement=e,this.ownerComponent=n,this.binding.setScope(t),this.isEvent?this.isDomEvent?this.ownerElement.addEventListener(this.nodeName,function(t){i.binding.compute({locals:{$event:t,$args:null,$element:i.ownerElement}})}):null!=n&&n.$listen(this.nodeName,function(t,e){i.binding.compute({locals:{$event:t,$args:e,$element:i.ownerElement}})}):(this.directive?(t.$$childDirectives.push(this.directive),this.directive.$setBinding(this.binding)):null!=n&&n.$hasAttr(this.nodeName)?n.$setAttr(this.nodeName,this.binding.compute()):this.nodeName.startsWith("style")?j(this.ownerElement,this.nodeName,this.binding.compute()):this.ownerElement.setAttribute(this.nodeName,this.binding.compute()),this.binding.watchProps(function(){i.detect()}))},Et.prototype.detect=function(){null==this.directive?this.hasChange()&&this.update():this.directive.$detect(this.ownerElement,this.ownerComponent)},Et.prototype.hasChange=function(){return this.binding.detect()},Et.prototype.update=function(){null!=this.ownerComponent&&this.ownerComponent.$hasAttr(this.nodeName)?this.ownerComponent.$setAttr(this.nodeName,this.binding.value):this.nodeName.startsWith("style")?j(this.ownerElement,this.nodeName,this.binding.value):(this.ownerElement.setAttribute(this.nodeName,this.binding.value),"INPUT"===this.ownerElement.nodeName&&"value"===this.nodeName&&(this.ownerElement.value=this.binding.value))},Et.prototype.afterLink=function(){this.directive&&this.directive.$insert(this.ownerElement,this.ownerComponent)},Et.prototype.directives=function(){return null==this.directive?[]:[this.directive]},Et.prototype.getOuterTpl=function(){return this.orgNodeName+(null==this.nodeValue?"":"="+this.quote+this.nodeValue+this.quote)},Et.prototype.getInnerTpl=function(){return this.orgNodeName+(null==this.nodeValue?"":"="+this.quote+this.nodeValue+this.quote)},Et.prototype.dispose=function(t){t&&(this.directive=null),this.binding.destroy(),this.binding=null,this.ownerVElement=null,this.ownerElement=null,this.ownerComponent=null,this.$destroy()},Et.prototype.destroy=function(){null!=this.directive&&(this.directive.$dispose(!0),this.directive=null),this.dispose()},f(Ct,$t),Ct.prototype.compile=function(){this.binding.bind(this.nodeValue)},Ct.prototype.link=function(t){var e=this;return this.binding.setScope(t),this.binding.watchProps(function(){e.detect()}),this.render(this.binding.compute())},Ct.prototype.hasChange=function(){return this.binding.detect()},Ct.prototype.update=function(){q(this.element,this.render(this.binding.value))},Ct.prototype.render=function(t){return this.element=document.createTextNode(t),this.element},Ct.prototype.getOuterTpl=function(){return this.nodeValue},Ct.prototype.getInnerTpl=function(){return this.nodeValue},Ct.prototype.destroy=function(){this.binding.destroy(),this.binding=null,this.element=null,this.$destroy()},f(Nt,$t),Nt.prototype.link=function(){return document.createComment(this.nodeValue)},f(function t(){t.super.call(this,xt.cdataSection)},$t),f(kt,$t),f(St,$t),It.prototype.getProps=function(t,e){var n=[];return Pt(this.text,new Proxy(t,new G(n,"",!0)),e),n},It.prototype.compute=function(t,e){this.oldValue=this.value,this.value=Pt(this.text,t,e)},It.prototype.detect=function(){return this.value!==this.oldValue},It.prototype.destroy=function(){this.value=null,this.oldValue=null,this.props=null},Tt.prototype.setScope=function(t){this.scope=t},Tt.prototype.setOutput=function(t){this.output=t},Tt.prototype.bind=function(t,e){if(null!=t)if(this.text=t,this.isExp=e,e)this.segments.push({exp:new It(t),leftStr:""});else{for(var n=/{{([^}]*)}}/g,i=n.lastIndex,o=n.exec(t);null!=o;)this.segments.push({index:o.index,exp:new It(o[1]),leftStr:t.substring(i,o.index)}),i=n.lastIndex,o=n.exec(t);this.segments.length>0&&i<t.length&&(this.rightStr=t.substring(i))}},Tt.prototype.compute=function(t){var e=this;if(0===this.segments.length)this.value=this.text;else if(this.isExp&&1===this.segments.length)this.segments[0].exp.compute(e.scope,t),this.value=this.segments[0].exp.value;else{var n="";this.segments.forEach(function(i){i.exp.compute(e.scope,t),n+=i.leftStr+i.exp.value}),this.value=n+this.rightStr}return this.value},Tt.prototype.watchProps=function(t){if(!this.output){var e=this,n=[];this.segments.forEach(function(t){n=n.concat(t.exp.getProps(e.scope))}),n.forEach(function(t){e.scope.$watch(t,function(){e.change.fire()})}),null!=t&&e.change.on(t)}},Tt.prototype.detect=function(t){if(this.output)return!1;var e=this;return this.compute(),this.segments.some(function(n){return n.exp.detect(e.scope,t)})},Tt.prototype.destroy=function(){this.segments.forEach(function(t){t.exp.destroy()}),this.scope=null},f(Vt,yt),Vt.prototype.parse=function(t){this.index=0,this.text=t,this.tokens=this.lexer.lex(t);for(var e,n=new St,i=!!this.options.allowDocType;this.index<this.tokens.length;){var o=this.current();if(o.doctype)i?e?this.throwError("DOCTYPE only allow one",o):(e=this.doctype(),n.$pushChild(e)):this.throwError("DOCTYPE is not allowed",o);else if(o.comment){var r=new Nt;r.nodeValue=o.text,n.$pushChild(r),this.next()}else if(o.textTag){(t=new Ct).nodeValue=o.text,n.$pushChild(t),this.next()}else o.tag&&o.begin?n.$pushChild(this.element()):this.throwError("impossible",o)}return n.$buildSibling(),n.childNodes},Vt.prototype.doctype=function(){this.next();var t=new kt,e=this.current();return e.identifier?t.nodeValue=e.text:this.throwError(" Unexpected ",e),this.attrs(t).forEach(function(e){t.childNodes.push(e)}),(e=this.current()).tag&&e.end&&e.closing?this.next():this.throwError(" Unexpected ",e),t},Vt.prototype.element=function(t){this.next();var e=new wt,n=this.current();if(n.identifier?(e.nodeName=n.text,this.next()):this.throwError(" Unexpected ",n),this.attrs(e).forEach(function(t){e.$pushAttribute(t)}),(n=this.current()).tag&&n.end){if(this.next(),"input"===e.nodeName)return e;n.closing||this.childElements(e).forEach(function(t){e.$pushChild(t)})}else this.throwError(" Unexpected ",n);return(n=this.current()).tag&&n.begin&&n.closing?(this.next(),(n=this.current()).identifier&&e.nodeName===n.text?(this.next(),(n=this.current()).tag&&n.end&&n.closing?this.next():this.throwError(" Unexpected ",n)):this.throwError(" Unexpected ",n)):this.throwError(" Unexpected ",n),e},Vt.prototype.childElements=function(t){for(var e=[];this.index<this.tokens.length;){var n=this.current();if(n.tag&&n.closing)break;if(n.comment){var i=new Nt;i.nodeValue=n.text,e.push(i),this.next()}else if(n.textTag){var o=new Ct;o.nodeValue=n.text,e.push(o),this.next()}else n.tag&&n.begin?e.push(this.element(t)):this.throwError(" Unexpected ",n)}return e},Vt.prototype.attrs=function(t){for(var e=[];this.index<this.tokens.length;){var n=this.current();if(n.tag&&n.end)break;var i=new Et;n.identifier&&(i.nodeName=n.text,i.orgNodeName=n.text,this.next(),(n=this.current()).equal&&(this.next(),(n=this.current()).constant?(i.nodeValue=n.value,this.next()):this.throwError(" Unexpected ",n))),e.push(i)}return e},Vt.prototype.current=function(){return this.index<this.tokens.length?this.tokens[this.index]:{}},Vt.prototype.next=function(){this.index++};var Dt={isIdentifierContinue:!1,isIdentifierStart:!1,literals:{false:!1,null:null,true:!0,undefined:void 0}};function At(t,e){var n,i;if(w(t))i=t,n=document.getElementById(t);else{if(null==(i=t.getAttribute("id")))throw new Error("Please id attribute for root component");n=t}e.template=n.innerHTML,Y.createComponent(Ft(i,e)).$mount(t)}function Ot(t){return new Vt(new gt(Dt),Dt).parse(t)}function jt(t,e){var n=p({getEmbedTpl:function(){return""},containsComponent:function(){return!1},createComponent:function(){return null},containsDirective:function(){return!1},createDirective:function(){return null}},e),i=Ot(t);return i.forEach(function(t){t.compile(n)}),i.forEach(function(t){t.directives().forEach(function(t){t.$compile(n)})}),function(t){var e=document.createDocumentFragment();return t.$$vnodes=i,Rt(t)||(t.$$childDirectives=[],t.$$childComponents=[],t.$detect=function(){i.forEach(function(t){t.detect()})},t.$destroy=function(){i.forEach(function(t){t.destroy()})}),i.forEach(function(n){e.appendChild(n.link(t))}),i.forEach(function(t){t.afterLink()}),e}}function Pt(t,e,n){if(null!=t&&0!==(t=t.trim()).length){t=t.replace("&gt;",">").replace("&lt;","<");var i=new yt(new X(Dt),Dt);return(n=n||{}).createFilter=function(t){return Y.createFilter(t)},i.parse(t).compile(e,n)}}function Mt(){this.$$vnodes=null,this.$$ownerVNode=null,this.$$parentComponent=null,this.$$childComponents=[],this.$$childDirectives=[],this.$$detectTimeout=null,this.$$propChanged=new z}function Ut(){this.$$binding=null,this.$$vnode=null,this.output=!1}function Bt(){}function Lt(){}function qt(t){return{component:function(e,n){return n.namespace=t,Ft(e,n)},directive:function(e,n){return N(n)&&(n={onInsert:n,onUpdate:n}),n.namespace=t,Wt(e,n)},service:function(e,n){return n.namespace=t,Kt(e,n)},filter:function(e,n){return N(n)&&(n={onExecute:n}),n.namespace=t,_t(e,n)}}}function Ft(t,e){return Y.buildConstructor(t,e,{contractType:R.component,superClass:Mt})}function Wt(t,e){return N(e)&&(e={onInsert:e,onUpdate:e}),Y.buildConstructor(t,e,{contractType:R.directive,superClass:Ut})}function _t(t,e){return N(e)&&(e={onExecute:e}),Y.buildConstructor(t,e,{contractType:R.filter,superClass:Bt})}function Kt(t,e){return Y.buildConstructor(t,e,{contractType:R.service,superClass:Lt})}function Rt(t){return t instanceof Mt}function Yt(t){return t instanceof Ut}function Ht(t){return t instanceof Bt}function zt(t){return t instanceof Lt}Mt.prototype.$onInit=function(){Object.defineProperty(this,"proxy",{enumerable:!1,configurable:!1,get:function(){return new Proxy(this,new Z(this.$$propChanged,"",!0))}}),Y.injectServices(this),null!=this.$$def.superInstance&&(this.$$propChanged.parentSubject=this.$$def.superInstance.$$propChanged),N(this.$$def.onInit)&&this.$$def.onInit.call(this)},Mt.prototype.$bindVNode=function(t){this.$$ownerVNode=t},Mt.prototype.$hasAttr=function(t){return A(this.$$def.props,t,!0)},Mt.prototype.$setAttr=function(t,e){j(this.proxy,t,e,!0),N(this.$$def.onChanges)&&this.$$def.onChanges.call(this,t,e)},Mt.prototype.$hasEvent=function(t){return D(this.$$def.events,t,!0)},Mt.prototype.$listen=function(t,e){var n=O(this,t,!0);if(!K(n))throw new Error(t+" is not a event");n.on(e)},Mt.prototype.$getTemplate=function(t){var e=this;return t?e.$$def.template||"":new Promise(function(t){w(e.$$def.template)?t(e.$$def.template):w(e.$$def.templateUrl)?Y.service("$templateCache").getTplByUrl(e.$$def.templateUrl).then(function(e){t(e)}):t("")})},Mt.prototype.$using=function(t){var e=this.$$def.using,n=t.split("."),i=n.pop(),o=n.join(".");return o&&$(e)&&h(e,function(e,n){if(e===o)return t=n+"."+i,!0}),t},Mt.prototype.$makeCompileOptions=function(){var t=this;return{getEmbedTpl:function(){return this.$$ownerVNode.getInnerTpl()},containsComponent:function(e){return Y.containsComponent(t.$using(e))},createComponent:function(e){return Y.createComponent(t.$using(e))},containsDirective:function(e){return Y.containsDirective(t.$using(e))},createDirective:function(e){return Y.createDirective(t.$using(e))}}},Mt.prototype.$hasVNodes=function(){return x(this.$$vnodes)},Mt.prototype.$fromVNodes=function(){var t=document.createDocumentFragment();return this.$$vnodes.forEach(function(e){t.appendChild(e.getDomElement())}),t},Mt.prototype.$clearVNodes=function(){this.$hasVNodes()&&(this.$$vnodes.forEach(function(t){t.destroy()}),this.$$vnodes=null)},Mt.prototype.$render=function(t){var e=this,n=null;return t?n=this.$hasVNodes()?this.$fromVNodes():jt(this.$getTemplate(t),this.$makeCompileOptions())(this):new Promise(function(t){e.$hasVNodes()?t(e.$fromVNodes()):e.$getTemplate().then(function(i){n=jt(i,e.$makeCompileOptions())(e),t(n)})})},Mt.prototype.$refresh=function(t){return this.$clearVNodes(),this.$render(t)},Mt.prototype.$mount=function(t,e){var n,i=this;L(n=w(t)?document.getElementById(t):t),e?(n.appendChild(this.$render(e)),i.$afterViewInit()):this.$render(e).then(function(t){n.appendChild(t),i.$afterViewInit()})},Mt.prototype.$afterViewInit=function(){N(this.$$def.afterViewInit)&&this.$$def.afterViewInit.call(this)},Mt.prototype.$unmount=function(){null!=this.$$ownerVNode?(this.$$ownerVNode.$remove(),this.$$ownerVNode.removeDomElement()):this.$hasVNodes()&&this.$$vnodes.forEach(function(t){t.removeDomElement()}),null!=this.$$parentComponent&&(this.$$parentComponent.$removeChild(this),this.$$parentComponent=null)},Mt.prototype.$detect=function(){if(!this.$$detectTimeout&&this.$$vnodes){var t=this;t.$$detectTimeout=setTimeout(function(){t.$$detectTimeout=null,t.$$vnodes.forEach(function(t){t.detect()})})}},Mt.prototype.$validate=function(t,e){var n=this;return this.$$propChanged.on(t,e,{beforeChanged:!0}),function(){n.$$propChanged.off(t,e)}},Mt.prototype.$watch=function(t,e){var n=this;return this.$$propChanged.on(t,e),function(){n.$$propChanged.off(t,e)}},Mt.prototype.$removeChild=function(t){var e=this.$$childComponents.indexOf(t);-1!==e&&(this.$$childComponents.splice(e,1),t.$$parentComponent=null)},Mt.prototype.$dispose=function(t){this.$unmount(),N(this.$$def.onDestroy)&&this.$$def.onDestroy.call(this),this.$$detectTimeout&&clearTimeout(this.$$detectTimeout),this.$clearVNodes(),this.$$propChanged.destroy(),t&&(this.$$ownerVNode=null),this.$$childComponents=null,this.$$childDirectives=null},Mt.prototype.$destroy=function(){this.$dispose(),null!=this.$$ownerVNode&&(this.$$ownerVNode.dispose(!0),this.$$ownerVNode=null)},Ut.prototype.$onInit=function(){Y.injectServices(this),N(this.$$def.onInit)&&this.$$def.onInit.call(this)},Ut.prototype.$bindVNode=function(t){this.$$vnode=t},Ut.prototype.$setBinding=function(t){this.$$binding=t},Ut.prototype.$compile=function(t){N(this.$$def.onCompile)&&this.$$def.onCompile.call(this,this.$$vnode,t)},Ut.prototype.$insert=function(t,e){N(this.$$def.onInsert)&&this.$$def.onInsert.call(this,t,this.$$binding,e)},Ut.prototype.$detect=function(t,e){if(N(this.$$def.onDetect))return this.$$def.onDetect.call(this,t,this.$$binding,e);this.$$binding.detect()&&this.$update(t,e)},Ut.prototype.$update=function(t,e){N(this.$$def.onUpdate)&&this.$$def.onUpdate.call(this,t,this.$$binding,e)},Ut.prototype.$dispose=function(t){N(this.$$def.onDestroy)&&this.$$def.onDestroy.call(this),t&&(this.$$vnode=null),this.$$binding=null},Ut.prototype.$destroy=function(){this.$dispose(),null!=this.$$vnode&&(this.$$vnode.dispose(!0),this.$$vnode=null)},Bt.prototype.$onInit=function(){Y.injectServices(this),N(this.$$def.onInit)&&this.$$def.onInit.call(this)},Bt.prototype.$execute=function(t){if(N(this.$$def.onExecute))return this.$$def.onExecute.apply(this,arguments)},Bt.prototype.$destroy=function(){N(this.$$def.onDestroy)&&this.$$def.onDestroy.call(this)},Lt.prototype.$onInit=function(){Y.injectServices(this),N(this.$$def.onInit)&&this.$$def.onInit.call(this)},Lt.prototype.$destroy=function(){N(this.$$def.onDestroy)&&this.$$def.onDestroy.call(this)};var Zt=n(0),Gt=n.n(Zt);qt("blackboard").service("$templateCache",{props:{tplCache:{},promiseCache:{}},methods:{getTplByUrl:function(t){var e=this;return this.tplCache[t]?new Promise(function(n){n(e.tplCache[t])}):(this.promiseCache[t]||(this.promiseCache[t]=Gt.a.get(t).then(function(n){return e.promiseCache[t]=null,e.tplCache[t]=n.data||"",e.tplCache[t]})),this.promiseCache[t])}}});function Jt(t){return function(e,n){n.compute()?e.hasAttribute(t)||e.setAttribute(t,""):e.hasAttribute(t)&&e.removeAttribute(t)}}qt("blackboard").directive("b-selected",Jt("selected")),qt("blackboard").directive("b-disabled",Jt("disabled")),qt("blackboard").directive("b-checked",Jt("checked")),qt("blackboard").directive("b-readonly",Jt("readonly")),qt("blackboard").directive("b-style",function(t,e){var n=e.compute();if(n||t.removeAttribute("style"),w(n))t.style=n;else{if(!$(n))throw new Error("Parameter of b-style should be string or object");s(n,function(e,n){t.style[e]=n}),e.scope.$watchObject(n,function(){s(n,function(e,n){t.style[e]=n})})}}),qt("blackboard").directive("b-show",function(t,e){t.style.display=e.compute()?"initial":"none"}),qt("blackboard").directive("b-hide",function(t,e){t.style.display=e.compute()?"none":"initial"}),qt("blackboard").directive("b-if",{props:{comment:null},onInsert:function(t,e){this.comment=document.createComment("b-if"),e.compute()||q(t,this.comment)},onUpdate:function(t,e){e.compute()?null==t.parentNode&&q(this.comment,t):null!=t.parentNode&&q(t,this.comment)},onDestroy:function(){this.comment=null}}),qt("blackboard").directive("b-switch",{props:{value:null},onInsert:function(t,e){this.value=e.compute()},onUpdate:function(t,e){this.value=e.compute()}}),qt("blackboard").directive("b-switch-default",{props:{attrNode:null,comment:null},methods:{isMatch:function(){for(var t=!0,e=this.attrNode.ownerVElement;null!=e.previousSibling&&t;){var n=e.previousSibling.getDirective("b-switch-when");e=e.previousSibling,n.length&&(t=!n[0].isMatch)}return t}},onCompile:function(t,e){this.attrNode=t},onInsert:function(t,e){this.comment=document.createComment("b-switch-default"),this.isMatch()||q(t,this.comment)},onDetect:function(t,e){this.isMatch()?null==t.parentNode&&q(this.comment,t):null!=t.parentNode&&q(t,this.comment)},onDestroy:function(){this.attrNode=null,this.comment=null}}),qt("blackboard").directive("b-switch-when",{props:{isMatch:!1,attrNode:null,comment:null},methods:{updateIsMatch:function(t,e){var n=this.attrNode.ownerVElement.parentNode.getDirective("b-switch");if(!n.length)throw new Error("Require b-switch directive");this.isMatch=e.compute()===n[0].value}},onCompile:function(t,e){this.attrNode=t},onInsert:function(t,e){this.comment=document.createComment("b-switch-when"),this.updateIsMatch(t,e),this.isMatch||q(t,this.comment)},onDetect:function(t,e){this.updateIsMatch(t,e),this.isMatch?null==t.parentNode&&q(this.comment,t):null!=t.parentNode&&q(t,this.comment)},onDestroy:function(){this.attrNode=null,this.comment=null}}),qt("blackboard").directive("b-bind",function(t,e){t.innerText=e.compute()}),qt("blackboard").directive("b-model",{methods:{update:function(t,e,n){null==n?t.value=e.compute():n.value=e.compute()}},onInsert:function(t,e,n){if(this.update(t,e,n),null!=n)throw K(n.change)&&n.change.on(function(t,n){e.scope.$setAttr(e.text,n.newvalue)}),new Error("Compoent "+n.$$key+"must define [change] event");t.addEventListener("change",function(t){e.scope.$setAttr(e.text,t.target.value)})},onUpdate:function(t,e,n){this.update(t,e,n)}}),qt("blackboard").directive("b-repeat",{onCompile:function(t,e){var n=t.nodeValue,i=t.ownerVElement,o=/^(\w+)\s+in\s+(\w+)$/i.exec(n);if(null==o)throw new Error("b-repeat: parameter is not valid");var r=o[1],h=o[2];i.removeAttribute(t);var c,u,p,a,l,d=[],f=i.getOuterTpl(),m=i.createCustom("b-repeat",function(t){var e,n=document.createDocumentFragment();return(e={local:!0,template:f,props:{},superInstance:c=t}).props[r]=null,l=Ft("b-repeat-item",e),y(Pt(h,c)),p=document.createComment("start: b-repeat"),a=document.createComment("end: b-repeat"),n.appendChild(p),n.appendChild(a),n});function y(t){u=x(t)?t:[],c.$watch(h+".length",function(){g(u)})}function g(t){var e=document.createDocumentFragment(),n=[];s(t,function(t,i){var o=function(t){var e=d.filter(function(e){return e[r]===t});if(0===e.length)return null;var n=e[0];return d=d.filter(function(e){return e[r]!==t}),n}(i);null==o&&((o=Y.createComponent(l))[r]=i),e.appendChild(o.$render(!0)),n.push(o)}),d.length>0&&d.forEach(function(t){t.$destroy()}),d=n,W(p,a),a.parentNode.insertBefore(e,a)}i.parentNode.replaceChild(i,m),i.destroy(),m.onInsert=function(){g(u)},m.onDetect=function(){var t=Pt(h,c);u!==t?(y(t),g(u)):d.forEach(function(t){t.$detect()})},m.onDestroy=function(){d.forEach(function(t){t.$destroy()}),d=null,i=null,c=null,u=null,p=null,a=null,m=null}}}),qt("blackboard").directive("b-embed",{onCompile:function(t,e){var n=e.getEmbedTpl();n&&t.ownerVElement.setInnerTpl(n)}}),n.d(e,"isMessenger",function(){return K}),n.d(e,"forEach",function(){return s}),n.d(e,"some",function(){return h}),n.d(e,"copy",function(){return c}),n.d(e,"extend",function(){return u}),n.d(e,"merge",function(){return p}),n.d(e,"object",function(){return d}),n.d(e,"inherit",function(){return f}),n.d(e,"lowercase",function(){return m}),n.d(e,"uppercase",function(){return y}),n.d(e,"isUndefined",function(){return g}),n.d(e,"isDefined",function(){return v}),n.d(e,"isObject",function(){return $}),n.d(e,"isBlankObject",function(){return b}),n.d(e,"isNumber",function(){return E}),n.d(e,"isDate",function(){return C}),n.d(e,"isFunction",function(){return N}),n.d(e,"isRegExp",function(){return k}),n.d(e,"isBoolean",function(){return S}),n.d(e,"isArray",function(){return x}),n.d(e,"isString",function(){return w}),n.d(e,"isSame",function(){return I}),n.d(e,"debug",function(){return T}),n.d(e,"contains",function(){return V}),n.d(e,"containsStr",function(){return D}),n.d(e,"hasProperty",function(){return A}),n.d(e,"getProperty",function(){return O}),n.d(e,"setProperty",function(){return j}),n.d(e,"concat",function(){return P}),n.d(e,"getChildNodes",function(){return B}),n.d(e,"clearChildNodes",function(){return L}),n.d(e,"replaceNode",function(){return q}),n.d(e,"removeNode",function(){return F}),n.d(e,"removeNodeBetween",function(){return W}),n.d(e,"insertNodeAfter",function(){return _}),n.d(e,"namespace",function(){return qt}),n.d(e,"injector",function(){return Y}),n.d(e,"component",function(){return Ft}),n.d(e,"directive",function(){return Wt}),n.d(e,"filter",function(){return _t}),n.d(e,"service",function(){return Kt}),n.d(e,"isComponent",function(){return Rt}),n.d(e,"isDirective",function(){return Yt}),n.d(e,"isFilter",function(){return Ht}),n.d(e,"isService",function(){return zt}),n.d(e,"bootstrap",function(){return At}),n.d(e,"compile",function(){return jt}),n.d(e,"compute",function(){return Pt}),n.d(e,"parse",function(){return Ot})}])});